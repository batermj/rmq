library(rmq)
context("msgpack encoding with to.msgpack() and from.msgpack()")

input = list()
sub = list()
sub$A = "hi"
sub$B = 4611686018427387904
sub$F = c(1.5, 3.4)
input$sub = sub
input$D = c("hello","world")
input$E = as.integer(c(32, 17))
input$G = NULL
input$Blob = as.raw(c(0xff,0xf0,0x06))

expected.output = =as.raw(c(0x85,0xa4,0x42,0x6c,0x6f,0x62,0xc4,0x03,0xff,0xf0,0x06,0xa1,0x44,0x92,0xa5,0x68,0x65,0x6c,0x6c,0x6f,0xa5,0x77,0x6f,0x72,0x6c,0x64,0xa1,0x45,0x92,0xcb,0x40,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0xcb,0x40,0x31,0x00,0x00,0x00,0x00,0x00,0x00,0xa1,0x47,0xc0,0xa3,0x53,0x75,0x62,0x83,0xa1,0x41,0x91,0xa2,0x68,0x69,0xa1,0x42,0x91,0xcb,0x43,0xd0,0x00,0x00,0x00,0x00,0x00,0x00,0xa1,0x46,0x92,0xcb,0x3f,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0xcb,0x40,0x0b,0x33,0x33,0x33,0x33,0x33,0x33))

observed.output = to.msgpack(input)
restored = from.msgpack(observed.output)

test_that("to.msgpack generates the expected encoded raw bytes", {
    expect_equal(observed.output, expected.output)
  })

test_that("from.msgpack restores the same structures that to.msgpack encoded", {
    expect_equal(restored, input)
  })
